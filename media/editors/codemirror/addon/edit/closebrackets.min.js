!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){function b(a,b){return"pairs"==b&&"string"==typeof a?a:"object"==typeof a&&null!=a[b]?a[b]:k[b]}function c(a){return function(b){return g(b,a)}}function d(a){var b=a.state.closeBrackets;if(!b)return null;var c=a.getModeAt(a.getCursor());return c.closeBrackets||b}function e(c){var e=d(c);if(!e||c.getOption("disableInput"))return a.Pass;for(var f=b(e,"pairs"),g=c.listSelections(),h=0;h<g.length;h++){if(!g[h].empty())return a.Pass;var j=i(c,g[h].head);if(!j||f.indexOf(j)%2!=0)return a.Pass}for(var h=g.length-1;h>=0;h--){var k=g[h].head;c.replaceRange("",l(k.line,k.ch-1),l(k.line,k.ch+1))}}function f(c){var e=d(c),f=e&&b(e,"explode");if(!f||c.getOption("disableInput"))return a.Pass;for(var g=c.listSelections(),h=0;h<g.length;h++){if(!g[h].empty())return a.Pass;var j=i(c,g[h].head);if(!j||f.indexOf(j)%2!=0)return a.Pass}c.operation(function(){c.replaceSelection("\n\n",null),c.execCommand("goCharLeft"),g=c.listSelections();for(var a=0;a<g.length;a++){var b=g[a].head.line;c.indentLine(b,null,!0),c.indentLine(b+1,null,!0)}})}function g(c,e){var f=d(c);if(!f||c.getOption("disableInput"))return a.Pass;var g=b(f,"pairs"),i=g.indexOf(e);if(-1==i)return a.Pass;for(var k,m,n=b(f,"triples"),o=g.charAt(i+1)==e,p=c.listSelections(),q=i%2==0,r=0;r<p.length;r++){var s,t=p[r],u=t.head,m=c.getRange(u,l(u.line,u.ch+1));if(q&&!t.empty())s="surround";else if(!o&&q||m!=e)if(o&&u.ch>1&&n.indexOf(e)>=0&&c.getRange(l(u.line,u.ch-2),u)==e+e&&(u.ch<=2||c.getRange(l(u.line,u.ch-3),l(u.line,u.ch-2))!=e))s="addFour";else if(o){if(a.isWordChar(m)||!j(c,u,e))return a.Pass;s="both"}else{if(!q||c.getLine(u.line).length!=u.ch&&!h(m,g)&&!/\s/.test(m))return a.Pass;s="both"}else s=n.indexOf(e)>=0&&c.getRange(u,l(u.line,u.ch+3))==e+e+e?"skipThree":"skip";if(k){if(k!=s)return a.Pass}else k=s}var v=i%2?g.charAt(i-1):e,w=i%2?e:g.charAt(i+1);c.operation(function(){if("skip"==k)c.execCommand("goCharRight");else if("skipThree"==k)for(var a=0;3>a;a++)c.execCommand("goCharRight");else if("surround"==k){for(var b=c.getSelections(),a=0;a<b.length;a++)b[a]=v+b[a]+w;c.replaceSelections(b,"around")}else"both"==k?(c.replaceSelection(v+w,null),c.triggerElectric(v+w),c.execCommand("goCharLeft")):"addFour"==k&&(c.replaceSelection(v+v+v+v,"before"),c.execCommand("goCharRight"))})}function h(a,b){var c=b.lastIndexOf(a);return c>-1&&c%2==1}function i(a,b){var c=a.getRange(l(b.line,b.ch-1),l(b.line,b.ch+1));return 2==c.length?c:null}function j(b,c,d){var e=b.getLine(c.line),f=b.getTokenAt(c);if(/\bstring2?\b/.test(f.type))return!1;var g=new a.StringStream(e.slice(0,c.ch)+d+e.slice(c.ch),4);for(g.pos=g.start=f.start;;){var h=b.getMode().token(g,f.state);if(g.pos>=c.ch+1)return/\bstring2?\b/.test(h);g.start=g.pos}}var k={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},l=a.Pos;a.defineOption("autoCloseBrackets",!1,function(b,c,d){d&&d!=a.Init&&(b.removeKeyMap(n),b.state.closeBrackets=null),c&&(b.state.closeBrackets=c,b.addKeyMap(n))});for(var m=k.pairs+"`",n={Backspace:e,Enter:f},o=0;o<m.length;o++)n["'"+m.charAt(o)+"'"]=c(m.charAt(o))});